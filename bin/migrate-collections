#!/usr/bin/env ruby
# frozen_string_literal: true

# Usage:
#   bin/migrate-collections collections.jsonl

require_relative '../config/environment'

File.foreach(ARGV[0]) do |data|
  json = JSON.parse(data)
  puts data
  creator = User.find_or_create_by!(email: "#{json.dig('creator', 'sunetid')}@stanford.edu")
  collection = Collection.find_or_initialize_by(druid: json['druid'])
  collection.update!(
    description: 'test', # TODO
    contact_email: 'test@example.com', # TODO
    access: 'world', # TODO
    creator: creator,
    name: json['name']
  )
end
